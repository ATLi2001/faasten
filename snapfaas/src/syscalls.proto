syntax = "proto3";

package snapfaas.syscalls;

message Invoke {
  string function = 1;
  string payload = 2;
}

message InvokeResponse {
  bool success = 1;
}

message Clause {
  // A disjuction of principals
  repeated string principals = 1;
}

message Component {
  // A conjunction of clauses
  repeated Clause clauses = 1;
}

message DcComponent {
  optional Component value = 1;
}

message DcLabel {
  // None means DcFalse, empty clauses means DcTrue, otherwise DcFormula
  optional Component secrecy = 1;
  // None means DcFalse, empty clauses means DcTrue, otherwise DcFormula
  optional Component integrity = 2;
}

message Request {
  string payload = 1;
}

message Response {
  string payload = 1;
}

message ReadKey {
  bytes key = 1;
}

message ReadKeyResponse {
  optional bytes value = 1;
}

message WriteKey {
  bytes key = 1;
  bytes value = 2;
}

message WriteKeyResponse {
  bool success = 1;
}

enum HttpVerb {
  GET = 0;
  POST = 1;
  PUT = 2;
  DELETE = 4;
}

message GithubRest {
  HttpVerb verb = 1;
  string route = 2;
  optional string body = 3;
  bool toblob = 4;
}

message GithubRestResponse {
  bytes data = 1;
  uint32 status = 2;
}

message GetCurrentLabel {
}

enum PathType {
  ABS = 0;
  REL_WORKSPACE = 1;
}

message Path {
  string value = 1;
  PathType pathT = 2;
}

message FSRead {
  Path path = 1;
}

message FSWrite {
  Path path = 1;
  bytes data = 2;
}

enum DentryType {
  DIR = 0;
  FILE = 1;
}

message FSCreate {
  Path basePath = 1;
  string name = 2;
  optional DcLabel label = 3;
  DentryType entryT = 5;
}

message BlobCreate {
  optional uint64 size = 1;
}

message BlobWrite {
  uint64 fd = 1;
  bytes data = 2;
}

message BlobFinalize {
  uint64 fd = 1;
  bytes data = 2;
}

message BlobResponse {
  bool success = 1;
  uint64 fd = 2;
  bytes data = 3;
}

message BlobOpen {
  string name = 1;
}

message BlobRead {
  uint64 fd = 1;
  optional uint64 offset = 2;
  optional uint64 length = 3;
}

message BlobClose {
  uint64 fd = 1;
}

message WorkspaceAbspath {
  string relpath = 1;
}

message WorkspaceAbspathResponse {
  string abspath = 1;
}

message Syscall {
  oneof syscall {
    Response response = 1;
    ReadKey readKey = 2;
    WriteKey writeKey = 3;
    GetCurrentLabel getCurrentLabel = 4;
    DcLabel taintWithLabel = 5;
    GithubRest githubRest = 6;
    Invoke invoke = 7;
    FSRead fsRead = 8;
    FSWrite fsWrite = 9;
    FSCreate fsCreate = 10;
    BlobCreate createBlob = 11;
    BlobWrite writeBlob = 12;
    BlobFinalize finalizeBlob = 13;
    BlobOpen openBlob = 14;
    BlobRead readBlob = 15;
    BlobClose closeBlob = 16;
    DcComponent declassify = 17;
    WorkspaceAbspath workspaceAbspath = 18;
  }
}
